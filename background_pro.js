var q=chrome,b=q.bookmarks,h=q.history,r_c=10,v_b=604800000,t={},p={},y={},x={},s=function(d,u){var n=new Date().getTime();t[d]=u;p[u]=d;h.getVisits({url:u},function(v){var r=0;for(var j=0,l=v.length;j<l;++j){r+=v_b/(n-v[j].visitTime)}y[u]=r})};var z=function(){x={};b.getRecent(r_c,function(m){for(var i=0,l=m.length;i<l;++i){x[m[i].url]=l-i}})};var g=function(){var a=function(e){for(var i=0,l=e.length;i<l;++i){var n=e[i];if(!n.url)a(n.children);else s(n.id,n.url)}};b.getTree(a)};b.onCreated.addListener(function(d,m){s(d,m.url);z()});b.onChanged.addListener(function(d,c){var o=t[d],u=c.url;p[o]=null;p[u]=d;t[d]=u;y[u]=y[o];y[o]=null;z()});b.onRemoved.addListener(function(d,r){var o=t[d];y[o]=p[o]=t[d]=null;z()});h.onVisited.addListener(function(y){var u=y.url;s(p[u],u);z()});h.onVisitRemoved.addListener(function(w){if(w.allHistory){g()}else for(var i=0,l=w.urls.length;i<l;++i)s(w.urls[i]);z()});this.g=function(u){var r=0;if(y[u])r+=y[u];if(x[u])r+=x[u];return r};g()